<!DOCTYPE html>
<html lang="en">
<head>
    <link rel=stylesheet type=text/css href="{{ url_for('static', filename='style.css') }}">
    <meta charset="UTF-8">
    <title>UserMainPage</title>
</head>

<body onload="getLocation();">
<h1>Welcome User {{username}}</h1>

<div style="display: none;" id=userID>{{username}}</div>
<div id = "divDest"></div>
    <input type="button" onclick="sendLog();">SEND LOG</input>
<script>

var x;
var y;

function sendLog(){
	var xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function(){
    if (this.readyState == 4 && this.status == 200) {
      if(this.responseText == "TIMEOUT"){
        if (confirm("Timeout, press Ok to reload!")) {
          window.location.replace("/API/Users/Login");
        } else {
          window.location.replace("/");
        }
      }
    }
  };
	var id = "{{username}}";
  var req = "/API/Users/Location?UserID="+id+"&x="+x+"&y="+y+"&building="+2;
	xhttp.open("GET",req, true)
	xhttp.send()
}


function getLocation() {
	var errorCallback;
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(showPosition,errorCallback,{timeout:1000});
  } else { 
   	document.getElementById("divDest").innerHTML = "Geolocation is not supported by this browser.";
  }
}

function showPosition(position) {
  x = position.coords.latitude;
  y = position.coords.longitude;
}
</script>
</body>
</html>